---
title: "Document API"
description: "Complete reference for the Document class and XML document management"
weight: 30
---

# Document API

The Document class represents the root of an XML document, containing the document element and preserving document-level formatting like XML declarations and DTDs.

## Overview

The Document class serves as the top-level container for an XML document, maintaining:

- **Document element** (root element)
- **XML declaration** with version, encoding, and standalone flag
- **DOCTYPE declarations** 
- **Processing instructions** at document level
- **Comments** before and after the root element
- **Whitespace** preservation between top-level nodes

## Creating Documents

### Factory Methods

```java
// Create empty document
Document doc = Document.of();

// Parse from XML string
Document doc = Document.of(xmlString);

// Parse from InputStream
Document doc = Document.of(inputStream);

// Parse from file
Document doc = Document.of(Path.of("config.xml"));

// Create with root element
Document doc = Document.withRootElement("project");

// Create with XML declaration
Document doc = Document.withXmlDeclaration("1.0", "UTF-8");
```

### Fluent API

```java
// Build document using fluent API
Document doc = Document.of()
    .version("1.1")
    .encoding("UTF-8")
    .standalone(true)
    .root(Element.of("project"))
    .withXmlDeclaration();
```

## Document Properties

### XML Declaration

```java
Document doc = Document.of();

// Set XML declaration components
doc.version("1.0");
doc.encoding("UTF-8");
doc.standalone(true);

// Generate XML declaration
doc.withXmlDeclaration();

// Access declaration
String xmlDecl = doc.xmlDeclaration(); // "<?xml version="1.0" encoding="UTF-8" standalone="yes"?>"
```

### Encoding Management

```java
// Set document encoding
doc.encoding("UTF-16");
String encoding = doc.encoding(); // "UTF-16"

// Encoding affects serialization
String xml = new Serializer().serialize(doc);
// Output will use UTF-16 encoding
```

### Version Control

```java
// Set XML version
doc.version("1.1");
String version = doc.version(); // "1.1"

// Version 1.1 allows additional characters in names
```

### Standalone Declaration

```java
// Set standalone flag
doc.standalone(true);
boolean isStandalone = doc.standalone(); // true

// Affects XML declaration output
String xmlDecl = doc.xmlDeclaration(); 
// Includes standalone="yes"
```

## Root Element Management

### Setting Root Element

```java
Document doc = Document.of();

// Create and set root element
Element root = Element.of("project");
doc.root(root);

// Access root element
Element rootElement = doc.root();
```

### Root Element with Namespaces

```java
// Create root with namespace
QName rootName = QName.of("http://maven.apache.org/POM/4.0.0", "project");
Element root = Element.of(rootName);
doc.root(root);

// Namespace declarations are preserved
```

## Document Structure

### Adding Top-Level Nodes

```java
Document doc = Document.withRootElement("html");

// Add processing instruction before root
ProcessingInstruction stylesheet = new ProcessingInstruction(
    "<?xml-stylesheet type=\"text/xsl\" href=\"style.xsl\"?>");
doc.insertBefore(doc.root(), stylesheet);

// Add comment after root
Comment footer = new Comment("<!-- Generated by DomTrip -->");
doc.addNode(footer);
```

### Document Traversal

```java
// Access all document nodes
Stream<Node> allNodes = doc.nodes();

// Find specific node types
List<Comment> comments = doc.nodes()
    .filter(node -> node instanceof Comment)
    .map(node -> (Comment) node)
    .collect(Collectors.toList());

// Find processing instructions
List<ProcessingInstruction> pis = doc.nodes()
    .filter(node -> node instanceof ProcessingInstruction)
    .map(node -> (ProcessingInstruction) node)
    .collect(Collectors.toList());
```

## DOCTYPE Support

### Setting DOCTYPE

```java
Document doc = Document.of();

// Set DOCTYPE declaration
doc.doctype("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" " +
           "\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">");

// Access DOCTYPE
String doctype = doc.doctype();
```

### DOCTYPE Preservation

```java
String xmlWithDoctype = """
    <?xml version="1.0"?>
    <!DOCTYPE root SYSTEM "example.dtd">
    <root>
        <element>content</element>
    </root>
    """;

Document doc = Document.of(xmlWithDoctype);
// DOCTYPE is preserved exactly as written
String preserved = doc.doctype();
```

## Document Statistics

### Node Counting

```java
Document doc = Document.of(complexXml);

// Count total nodes
int totalNodes = doc.nodeCount();

// Count specific node types
long elementCount = doc.nodes()
    .filter(node -> node instanceof Element)
    .count();

long commentCount = doc.nodes()
    .filter(node -> node instanceof Comment)
    .count();
```

### Document Analysis

```java
// Get document statistics (when using Editor)
Editor editor = new Editor(doc);
String stats = editor.documentStats();
// Returns formatted statistics about the document
```

## Serialization

### Basic Serialization

```java
Document doc = Document.withRootElement("root");

// Serialize with default settings
Serializer serializer = new Serializer();
String xml = serializer.serialize(doc);
```

### Custom Serialization

```java
// Serialize with custom configuration
DomTripConfig config = DomTripConfig.prettyPrint()
    .withIndentString("  ")
    .withLineEnding("\n");

Serializer serializer = new Serializer();
String xml = serializer.serialize(doc, config);
```

## Advanced Features

### Document Cloning

```java
Document original = Document.of(xmlString);

// Create a copy (deep clone)
Document copy = Document.of(original.toXml());

// Modifications to copy don't affect original
```

### Document Validation

```java
Document doc = Document.of();

// Check if document is valid
boolean hasRoot = doc.root() != null;
boolean hasValidStructure = doc.nodeCount() > 0;

// Validate XML declaration
boolean hasXmlDecl = !doc.xmlDeclaration().isEmpty();
```

### Memory Management

```java
// For large documents, consider memory usage
Document largeDoc = Document.of(largeXmlFile);

// Process in sections if needed
Element root = largeDoc.root();
// ... process specific elements

// Clear references when done
largeDoc = null; // Allow garbage collection
```

## Integration with Editor

The Document class works seamlessly with the Editor API:

```java
// Create document and edit
Document doc = Document.withRootElement("config");
Editor editor = new Editor(doc);

// Editor operations modify the document
editor.addElement(editor.root(), "setting", "value");

// Document reflects changes
Element setting = doc.root().child("setting").orElse(null);
```

## Best Practices

### ✅ **Do:**
- Use factory methods for document creation
- Set encoding explicitly for non-UTF-8 documents
- Preserve XML declarations when round-tripping
- Use fluent API for complex document setup
- Handle null checks for optional elements

### ❌ **Avoid:**
- Creating documents without root elements
- Modifying document structure directly (use Editor instead)
- Ignoring encoding when parsing from streams
- Setting invalid XML version numbers
- Creating malformed DOCTYPE declarations

## Error Handling

```java
try {
    Document doc = Document.of(xmlString);
    
    // Validate document structure
    if (doc.root() == null) {
        throw new IllegalStateException("Document has no root element");
    }
    
} catch (DomTripException e) {
    // Handle parsing errors
    System.err.println("Failed to parse document: " + e.getMessage());
}
```

## Performance Considerations

- **Lazy loading** - Document content is parsed on demand
- **Memory efficient** - Only modified nodes are tracked
- **Streaming friendly** - Large documents can be processed efficiently
- **Minimal overhead** - Document metadata has negligible memory impact

The Document API provides the foundation for all XML processing in DomTrip, offering both simplicity for basic use cases and power for complex document manipulation scenarios.
